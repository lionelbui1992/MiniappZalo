import o from'./../../external/@swc/helpers/src/_async_to_generator.mjs.js';import{RESPONSE_CODE as t,MESSAGES as e}from"../../constants.js";import a from"../../utils/lodash.js";import{MPEEmitter as i,onActionMessage as n,fireActionMessage as l}from"../eventEmitter.js";import{parseJSON as r,checkIOSSupportAction as s,serialize as c}from"../../utils/common.js";import u from"../token.js";import{sendLogData as d}from"../utils.js";import m from"../../appEnv/getEnv.js";import{__generator as p}from'./../../external/tslib/tslib.es6.js';import{Events as v}from"../../types/enum.js";var f,_,h,T,g,I,b=(h=m(),T={},g=i.getInstance(),I=[],!1||(n((function(o){var t=o.serialId,e=r(o.result);if(t&&T[t]){var i=T[t],n=i.callback,l=i.timeout,s=i.isMultiCallback,c=i.options;!function(o,t){var e=t||{},i=e.success,n=e.fail;0===o.error_code?a.isFunction(i)&&i(o):a.isFunction(n)&&n(o)}(e,n),!s&&delete T[t],l&&clearTimeout(l);var u={action:null==e?void 0:e.action,error:null==e?void 0:e.error_code,message:null==e?void 0:e.error_message,data:{}};try{if("action.open.inapp"===e.action||"action.open.outapp"===e.action){var d=new URL(null==c?void 0:c.url),m="".concat(d.protocol,"//").concat(d.host).concat(d.pathname);u.data={url:m}}if("action.follow.oa"===e.action||"action.unfollow.oa"===e.action){var p=null==c?void 0:c.uid;u.data={uid:p}}if("action.open.chat"===e.action){var v=null==c?void 0:c.uId,f=null==c?void 0:c.type;u.data={uid:v,openChatType:f}}}catch(o){}I.push(u)}})),g.on(v.AppPaused,(function(){if(I.length>0){var o=I;I=[],d(o)}})),f?clearInterval(f):f=setInterval((function(){if(I.length>0){var o=I;I=[],d(o)}}),5e3),!0),_=o((function(o,i,n,r){var d,m,v,f,_,g,I,b,j,M,k,w,C,N,O,E,S;return p(this,(function(p){switch(p.label){case 0:return m=Math.floor(1e6*Math.random()),v="".concat(o,"_").concat(m),f="action.".concat(o.replace(/\_/g,".").toLowerCase()),(null==r?void 0:r.actionName)&&r.actionName.length>0&&(f=null==r?void 0:r.actionName),_=(null==r?void 0:r.isMultiCallback)||!1,g=!1!==(null==r?void 0:r.timeout)&&((null==r?void 0:r.timeout)||!0),I=(null==r?void 0:r.haveActionCallback)||!1,b=(null==r?void 0:r.skipJump)||!1,j=(null==r?void 0:r.requireAccessToken)||!1,i&&n&&(T[v]={options:i,callback:n,isMultiCallback:_},g&&I&&(T[v].timeout=setTimeout((function(){var a={serialId:v,result:{error_code:t.TIME_OUT,error_message:e.TIME_OUT,data:{timeout:g},action:o}};l(a)}),!0===g?8e3:1e3*g))),!(null==h||null===(d=h.platform)||void 0===d?void 0:d.isMobile)||!o||a.isUndefined(ZaloJavaScriptInterface)||h.platform.isIOS&&!s(o)?(k={serialId:v,result:{error_code:t.CLIENT_NOT_SUPPORT,error_message:e.CLIENT_NOT_SUPPORT,data:{isMobile:null==h||null===(M=h.platform)||void 0===M?void 0:M.isMobile},action:o}},l(k),[2]):(w=c(i),b?[3,2]:[4,u.getJSAccessToken()]);case 1:return N=p.sent(),[3,3];case 2:N="",p.label=3;case 3:return C=N,b||!j?[3,5]:[4,u.getAccessToken()];case 4:return E=p.sent(),[3,6];case 5:E="",p.label=6;case 6:return O=E,S=h.platform.isIOS?window.onNativeMessage(v):"window.onNativeMessage('".concat(v,"')"),[2,ZaloJavaScriptInterface.jsCall(C,f,O,w,S)]}}))})),function(o,t,e,a){return _.apply(this,arguments)});export{b as default};
